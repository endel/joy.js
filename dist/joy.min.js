/* 
 * joy.js v0.2.1 
 * http://joyjs.org
 * 
 * @copyright 2012-2013 Endel Dreyer 
 * @license MIT
 * @build 7/17/2013
 */
!function(a){var b=a.Joy||{Init:{},Render:{},Input:{},Context:{},debug:!1,deltaTime:1,ready:function(a){document.onload=a}};b.generateUniqueId=function(){return"joy"+(new Date).getTime()},a.Joy=b}(window),function(a){a.CompositeOperation={SOURCE_OVER:"source-over",SOURCE_IN:"source-in",SOURCE_OUT:"source-out",SOURCE_ATOP:"source-atop",LIGHTER:"lighter",XOR:"xor",DESTINATION_OVER:"destination-over",DESTINATION_IN:"destination-in",DESTINATION_OUT:"destination-out",DESTINATION_ATOP:"destination-atop",DESTINATION_COPY:"copy"}}(Joy),function(a){a.Events={INIT:"init",SCENE_ACTIVE:"sceneActive",ADDED:"added",REMOVED:"removed",UPDATE:"update",COLLISION:"collision",COLLISION_ENTER:"collisionEnter",COLLISION_EXIT:"collisionExit"}}(Joy),function(a){a.currentEngine=null;var b=function(b){if(a.currentEngine=this,this.paused=!1,"string"==typeof b.tagName&&"CANVAS"===b.tagName){b={canvas:b};var c=Joy.Markup.evaluateDataset(b.canvas);for(var d in c)b[d]=c[d]}if(b.canvas&&(this.context=new Joy.Context.Context2d({canvas:b.canvas})),!this.context){var e=b.context||Joy.Context.Context2d;this.context=new e({canvas:document.createElement("canvas")}),document.body.appendChild(this.context.canvas)}b.width&&(this.context.canvas.width=b.width),b.height&&(this.context.canvas.height=b.height),this.context.canvas.style.width=this.context.canvas.width/window.devicePixelRatio+"px",this.context.canvas.style.height=this.context.canvas.height/window.devicePixelRatio+"px",b.fullscreen&&(window.onresize=function(){}),"undefined"!=typeof a.Mouse&&a.Mouse.enable(this),b.debug&&(Joy.debug=!0),this.scenes=[],Object.defineProperty(this,"width",{get:function(){return this.context.canvas.width},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return this.context.canvas.height},configurable:!0}),Object.defineProperty(this,"currentScene",{get:function(){return this.scenes[this._currentSceneIndex]},set:function(b){null!==this._currentSceneIndex&&(this.scenes[this._currentSceneIndex].visible=!1,this.scenes[this._currentSceneIndex].viewport.reset()),this.sceneLoader&&b.loader.loading?(this._currentSceneIndex=this.scenes.indexOf(this.sceneLoader),this.sceneLoader.loader=b.loader,this.sceneLoader.visible=!0,b.visible=!1,b.loader.bind("loadComplete",function(){a.currentEngine.gotoScene(b)})):(this._currentSceneIndex=this.scenes.indexOf(b),b.visible=!0,b.broadcast(a.Events.SCENE_ACTIVE,[b]))}}),this._currentSceneIndex=null,this.sceneLoader=null,this.setSceneLoader(a.Engine.defaultSceneLoader),this.context.canvas.children.length>0&&(this.markup=new a.Markup(this).parse()),Joy.debug?(this._lastRenderTime=new Date,this._frameRateText=new Joy.Text({x:4,y:4,font:"12px Verdana",color:"red"}),this.onEnterFrameDebug()):this.onEnterFrame()};b.prototype.createScene=function(b){var c=new a.Scene({ctx:this.context.ctx});return"function"==typeof b&&b.apply(this,[c]),this.addScene(c),c},b.prototype.setSceneLoader=function(b){var c="object"==typeof b?b:new a.Scene({ctx:this.context.ctx,loader:null});return"function"==typeof b&&b.apply(this,[c]),-1===this.scenes.indexOf(c)&&this.scenes.push(c),this.sceneLoader=c,c},b.prototype.pause=function(){this._deltaTime=a.deltaTime,a.deltaTime=0,this.paused=!0},b.prototype.resume=function(){a.deltaTime=this._deltaTime,this.paused=!1},b.prototype.gotoNextScene=function(a,b){if("undefined"==typeof this.scenes[this._currentSceneIndex+1])throw new Error("There is no next scene.");return this.gotoScene(this.scenes[this._currentSceneIndex+1],a,b)},b.prototype.gotoScene=function(a,b,c){var d=this;return b||(b=1e3),c||(c="#000"),this.currentScene.fadeOut(b,c).bind("fadeOutComplete",function(){d.currentScene=a,d.currentScene.fadeIn(b,c)}),this},b.prototype.addScene=function(a){a.engine=this,a.setContext(this.context.ctx),Joy.debug&&a.viewport.addHud(this._frameRateText),this.scenes.push(a),null===this._currentSceneIndex&&(this.currentScene=a)},b.prototype.render=function(){this.context.render(this.scenes)},b.prototype.onEnterFrame=function(){a.currentEngine.paused||(a.TweenManager.update(),a.currentEngine.render()),window.onEnterFrame(a.currentEngine.onEnterFrame)},b.prototype.onEnterFrameDebug=function(){var b=new Date;a.currentEngine._frameRateText.text=(1e3/(b-a.currentEngine._lastRenderTime)).toFixed(1).toString()+" FPS",a.currentEngine.paused||(a.TweenManager.update(),a.currentEngine.render()),a.currentEngine._lastRenderTime=b,window.onEnterFrame(a.currentEngine.onEnterFrameDebug)},a.Engine=b}(Joy),function(){var a=!1,b=/xyz/.test(function(){"xyz"})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d},Joy.Object=Class}(Joy),function(a){function b(a){return""!==d&&(a=a.charAt(0).toUpperCase()+a.slice(1)),d+a}var c=navigator.userAgent,d=c.match(/opera/i)&&"o"||c.match(/webkit/i)&&"webkit"||c.match(/msie/i)&&"ms"||c.match(/mozilla/i)&&"moz"||"";"function"!=typeof window.addEventListener&&(HTMLElement.prototype.addEventListener=function(a,b){attachEvent("on"+a,b)}),a.Support={touch:"ontouchstart"in window,retina:window.devicePixelRatio>1||window.matchMedia("(min-resolution: 1.1dppx)").matches,imageSmoothingEnabled:b("imageSmoothingEnabled")},window.onEnterFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}(Joy),function(a){var b=a.Object.extend({init:function(a){this._handlers=a&&a._handlers||{},this._behaviours=a&&a._behaviours||[]},behave:function(b,c){var d;if("string"==typeof b){var e,f=b.split(",");for(d=0,l=f.length;l>d;d++)e=this.behave(a.Behaviour.get(f[d].replace(" ","")),c);return e}this._behaviours.push(b.id);var g=new b(c);for(d in g)"string"==typeof Joy.Events[d]?this.bind(Joy.Events[d],g[d]):"constructor"!==d&&(this[d]=g[d]);return this},hasBehaviour:function(a){return this._behaviours.indexOf(a)>=0},bind:function(a,c){var d=c;return void 0!==b._custom.bind[a]&&(d={target:this,handler:c},b._custom.bind[a].call(this,d)),void 0===this._handlers[a]&&(this._handlers[a]=[]),-1===this._handlers[a].indexOf(d)&&this._handlers[a].push(d),this},unbind:function(a){if(void 0!==b._custom.unbind[a])for(var c=0,d=this._handlers[a].length;d>c;++c)b._custom.unbind[a].call(this,this._handlers[a][c]);return this._handlers[a]=null,this},trigger:function(a,b,c){var d=this._handlers[a]||[];b=b||[],c=c||0;for(var e=0,f=d.length;f>e;++e)d[e].apply(this,b)},broadcast:function(a,b,c){this.trigger(a,b,c)}});b._custom={bind:{},unbind:{}},b.register=function(a,c,d){return b._custom.bind[a]=c,b._custom.unbind[a]=d,this},b.register(Joy.Events.INIT,function(a){a.handler.call(this)}),a.Triggerable=b}(Joy),function(){Math.clamp=function(a,b,c){return b>a?b:a>c?c:+a}}(Joy),function(a){var b=function(a,b,c,d,e,f){return null!==a&&(this.m11=a),this.m12=b||0,this.m21=c||0,null!==d&&(this.m22=d),this.dx=e||0,this.dy=f||0,this};b.prototype.appendTransform=function(a,c,d,e,f,g,h,i,j){var k,l,m;return f%360?(m=f*b.DEG_TO_RAD,k=Math.cos(m),l=Math.sin(m)):(k=1,l=0),g||h?(g*=b.DEG_TO_RAD,h*=b.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),a,c),this.append(k*d,l*d,-l*e,k*e,0,0)):this.append(k*d,l*d,-l*e,k*e,a,c),(i||j)&&(this.dx-=i*this.m11+j*this.m21,this.dy-=i*this.m12+j*this.m22),this},b.prototype.append=function(a,b,c,d,e,f){var g=this.m11,h=this.m12,i=this.m21,j=this.m22;return this.m11=a*g+b*i,this.m12=a*h+b*j,this.m21=c*g+d*i,this.m22=c*h+d*j,this.dx=e*g+f*i+this.dx,this.dy=e*h+f*j+this.dy,this},b.prototype.invert=function(){var a=this.m11,b=this.m12,c=this.m21,d=this.m22,e=this.dx,f=a*d-b*c;return this.m11=d/f,this.m12=-b/f,this.m21=-c/f,this.m22=a/f,this.dx=(c*this.dy-d*e)/f,this.dy=-(a*this.dy-b*e)/f,this},b.prototype.clone=function(){return new b(this.m11,this.m12,this.m21,this.m22,this.dx,this.dy)},b.prototype.identity=function(){return this.m11=this.m22=1,this.m12=this.m21=this.dx=this.dy=0,this},b.DEG_TO_RAD=Math.PI/180,b.identity=new b(1,0,0,1,0,0),a.Matrix2D=b}(Joy),function(a){var b=function(a,b){var c=a,d=b;"object"==typeof c&&(c=a.min||0,d=a.max||0),this.min=parseFloat(c||0,10),this.max=parseFloat(d||this.min||0,10)};b.prototype.random=function(){return b.random(this.min,this.max)},b.prototype.randomInt=function(){return b.randomInt(this.min,this.max)},b.parse=function(a){if("string"==typeof a){var c=a.split("..");return new b(c[0],c[1])}return new b(a)},b.random=function(a,b){return Math.random()*(b-a+1)+a},b.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},a.Range=b}(Joy),function(a){var b=function(a,c){this.x=a||0,this.y=c||0,Object.defineProperty(this,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},configurable:!0}),Object.defineProperty(this,"normalized",{get:function(){var a=this.length;return new b(this.x/a,this.y/a)},configurable:!0})};b.prototype.set=function(a,b){return this.x=a,this.y=b,this},b.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.sum=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.scale=function(a,b){return this.x*=a,this.y*=b||a,this},b.prototype.clone=function(){return new b(this.x,this.y)},b.prototype.unit=function(){return new b(Math.cos(this.x),Math.sin(this.y))},b.prototype.normalize=function(){var a=this.normalized;return this.x=a.x,this.y=a.y,this},b.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b.prototype.toString=function(){return"#<Vector2d @x="+this.x+", @y="+this.y+">"},b.LEFT=new b(-1,0),b.RIGHT=new b(1,0),b.TOP=new b(0,-1),b.BOTTOM=new b(0,1),a.Vector2d=b}(Joy),function(a){var b=function(a,b,c,d){this.red=a,this.green=b,this.blue=c,this.alpha=d};b.prototype.toString=function(){return this.green||this.blue?this.alpha?"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")":"rgb("+this.red+","+this.green+","+this.blue+")":this.red},a.Color=b}(Joy),function(a){var b=a.Triggerable.extend({init:function(){this._super(),this.assets=[],this.loaded=0,Object.defineProperty(this,"percentage",{get:function(){return Math.round(100*(this.loaded/this.assets.length))},configurable:!0}),Object.defineProperty(this,"loading",{get:function(){return this.assets.length!==this.loaded},configurable:!0}),Object.defineProperty(this,"completed",{get:function(){return this.assets.length>0&&!this.loading},configurable:!0})},add:function(a){var b=this;this.assets.push(a),a.addEventListener("load",function(){b.loaded+=1,b.trigger("loadProgress"),b.loaded==b.assets.length&&b.trigger("loadComplete")})}});a.Loader=b}(Joy),function(a){var b=function(){};b.process=function(a,b){var c=a.getImageData(0,0,a.canvas.width,a.canvas.height);b.call(this,c),a.putImageData(c,0,0)};var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];b.blur=function(a){var b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=function(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},z=a.data,A=5,B=a.width,C=a.height,D=A+A+1,E=B-1,F=C-1,G=A+1,H=G*(G+1)/2,I=new y,J=I;for(f=1;D>f;f++)J=J.next=new y,f==G&&(x=J);J.next=I;var K=null,L=null;j=i=0;var M=c[A],N=d[A];for(e=0;C>e;e++){for(q=r=s=k=l=m=0,n=G*(t=z[i]),o=G*(u=z[i+1]),p=G*(v=z[i+2]),k+=H*t,l+=H*u,m+=H*v,J=I,f=0;G>f;f++)J.r=t,J.g=u,J.b=v,J=J.next;for(f=1;G>f;f++)g=i+((f>E?E:f)<<2),k+=(J.r=t=z[g])*(w=G-f),l+=(J.g=u=z[g+1])*w,m+=(J.b=v=z[g+2])*w,q+=t,r+=u,s+=v,J=J.next;for(K=I,L=x,b=0;B>b;b++)z[i]=k*M>>N,z[i+1]=l*M>>N,z[i+2]=m*M>>N,k-=n,l-=o,m-=p,n-=K.r,o-=K.g,p-=K.b,g=j+((g=b+A+1)<E?g:E)<<2,q+=K.r=z[g],r+=K.g=z[g+1],s+=K.b=z[g+2],k+=q,l+=r,m+=s,K=K.next,n+=t=L.r,o+=u=L.g,p+=v=L.b,q-=t,r-=u,s-=v,L=L.next,i+=4;j+=B}for(b=0;B>b;b++){for(r=s=q=l=m=k=0,i=b<<2,n=G*(t=z[i]),o=G*(u=z[i+1]),p=G*(v=z[i+2]),k+=H*t,l+=H*u,m+=H*v,J=I,f=0;G>f;f++)J.r=t,J.g=u,J.b=v,J=J.next;for(h=B,f=1;A>=f;f++)i=h+b<<2,k+=(J.r=t=z[i])*(w=G-f),l+=(J.g=u=z[i+1])*w,m+=(J.b=v=z[i+2])*w,q+=t,r+=u,s+=v,J=J.next,F>f&&(h+=B);for(i=b,K=I,L=x,e=0;C>e;e++)g=i<<2,z[g]=k*M>>N,z[g+1]=l*M>>N,z[g+2]=m*M>>N,k-=n,l-=o,m-=p,n-=K.r,o-=K.g,p-=K.b,g=b+((g=e+G)<F?g:F)*B<<2,k+=q+=K.r=z[g],l+=r+=K.g=z[g+1],m+=s+=K.b=z[g+2],K=K.next,n+=t=L.r,o+=u=L.g,p+=v=L.b,q-=t,r-=u,s-=v,L=L.next,i+=B}},b.noise=function(a){var b,c,d,e=0;for(b=0;b<a.width;++b)for(c=0;c<a.height;++c)d=.8*Math.random(),e=4*b+c*4*a.width,a.data[e]*=d,a.data[e+1]*=d,a.data[e+2]*=d},a.Shader=b}(Joy),function(a){a.Utils={applyFriction:function(b,c){return 0>b+c?b+c*a.deltaTime:b-c>0?b-c*a.deltaTime:0}}}(Joy),function(a){a.Engine.defaultSceneLoader=function(a){var b,c,d,e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEcAAABkCAMAAADjVt21AAADAFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJBwYjGxnlTCblTCblTCblTSflTSblTijlTijlTyjlTynlUSrlUSvmUy7lUy3lVS/mVzHmWDLnWjbmXDbnYD3oYT3oYTrrYjTvYyzqYzrtYzCCZF3oZELoZUPoZELqbUzqdFXreFrre13sfF/sgGXsg2fthmztiW+zjILtjHPujnXuknrvln/vmYLwnIfxoIvxo47xpZHyqJXYqZ3yqpfyrZvzr57zs6L0tqb0uqvuvK7yv7L2w7b0w7b2xbn2xrr2x7vs7/Dt8PHw8vL19vb7+/v+/v7////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/fz//v7+/v7s8vTs8/Xs8/Xs8vTs8fP47uvs7e3s7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozz497y3NTx187w0cfxy77xwK/xtJ/vq5Xuo4rsnobsl33sk3ftj3DsiWnuhF/sfFbsc0vrbUTyaC3yaC7yaC3yaC7pZ0DyZyvyZirxZizzZSjxZCjxZCjxZCjxZCjyZSnyZSjxZCryZSjxZCjxZCjxZCjxZCjzZSjzZSjzZSjxZSnwYinwYSfwYSjxYCPwYCTwYCbxXyDxXyLxXR3xXR7xXh/vXCDxXB3uWyLsWibrWSbrWCfqVyfpViboUyToUCLlTiflTiblTiblTiblTiblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTCbkTCblTCblTCblTCXlTCXlTCTlSyTlSyPmSx/lSiPlSiLlSSLkSSHlSR7kSCDkSCDkRx/kRh7kRh3lRh3kRh7kRRzlRRzkRBzlRBvlRBtkxwbdAAAAeXRSTlMAAAAAAAAAAAAAAAECX19fX2Bk/mL+/Px3+vtx+pD9qoT97Pnh8ga/ydKYpaShnpaQiIAHeHNpYVpTS0Q+NgcyLCYiHRoHBxQHDwgM/vrRn1QvycTAua+mn5aMhnlxbmlmYFpRSUEyKiIfHBUcIuLm6/nc9/Xy79fSI5QIfgAAAAZ0RVh0VGl0bGUAqO7SJwAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAKdEVYdENvcHlyaWdodACsD8w6AAAAB3RFWHRFLW1haWwAfQib1QAAAAR0RVh0VVJMAHij0w8AAAjpSURBVFjD7ZhNTBtJFsd96eNIc3EQCLECcbHIBIj4Dihh+Aiwc8gQ8+FAkgnhM5YmDFkSria0LIeDDxiMvwBje5FYFk67Pq1DIHFstTJZEubsKy3swfG22pasbbaqutvd7bYxLNGe9h1sNy7/eO9V/evVKwXGWd/U1NQweB/pmwSmvoNhXfBPvV0Ydge8T/3ID8SGwNMAeOuGA1/cG0d/VPDfdut0uscYNqjjrK8LG4bvQ5h2Cj6mMNgD8NiPDfADn41KOHcR54EuZf0Y1gveZrCH4HV6QuDAZ83EL/w4tVbGGdY+h7/p1zyFA0awiWnw9mAGvNzHpJx7Q+Dl59HRhzOTE5iMMwK/fQ78nIChaIQoX3Rl4jzrHRyZeIJl4GjYeDDsPvjQjWHaFyznMYZlieupZlzOGe4DLwPw6Q7MTAeGPUaDe7F0Tj82NMn5+nRMwlFDf+AkqOETdKwHfuiBkY5LOD+xTj952PMcgTQpztg9LZrckRH493tPtA+e8bmFP7oLP4xqNJr7WNfACPofGuxR7ximHe3h/x/gdIz8rJtCiRjvgnOjm0YuT2r5IBAHJrZb26ubRkN+GvsTCFwzMMMnFHCeTPNLrwMb5aPW/TKMSTgwYz393JeT4zPCQhvh/XnExnkXTuFoN/vlDItBEzfD+3N3jP355DA20sNN2POHwnyND/aoe4fYNdI1rFGr++9ouaSODg4ODqEcog/aR33qnkG09H580KdW994fT1s/l7T/c/5HnG+/+fby9k2dojQWurzRZQoV9RU48XLFVfpr+FOlKE98DU6N4npuf47OMjQiVq+oyZ2fg49nmBIMII8aFfU55+vow9Z2Vts6AB4d591SNJJkTs62L7t9ApxIYYvipvJynEPAOSnpVHyfH07/4TGVZJJ05Dycnde/wTSr2hSdJVEpJcKENl3OdXceE8vN2X4DR1AqTNGmkiY6mbdqXjDgeuOivYghc3LeHiFZAL1LhcG4lnDDvBGYATetJcK5OB8Q5xrglIkXIuM06o28/YDb6ePzcBKVgPOdiJN0GX8wigxfYXJwPiJ/qgGnQuCElUt6McY4v+Chz+bAZRiiagGnWuAwa7hRarg1cQ7OSQPg1KXmiyTN+jTO/EJxTMLx+glggT3+GXLIwybAEYRBFS/Mp3GMeicj4niDfveKzWpb8wT8giyO85sB59aVY46TcBnSMUbccSpw9oPO5TlU1V9Z3IRXkEUr4LQU8ApIruvlHJvgz97fLMIpY9Ye8PKyKG0DnM6Sk9SsZ/DHnvJn37esE5st6N3hZQE4gjAojzw/+Brvjzdo0Ulthdh+w8kC1sGUMMDykTvkoTlOwJmG0b3y7L/lZAE5gjAYR/r60VtiJMvx+s3pHJ31PS8LyBGEESsypTlkcCW5deh3z8k4po1fOVlATmVCJFN8Pn05cxzCIcPoXro+I1nUIU6VIAwy4cBFQsUtymiKY5VzdE7EiTQgTq1oIwsnVxc4l+Zxg/WQCp3JWfudkwXkNIg3VpLZtJr0OLAFiyt5IuyHhC2TP//iZAE5TYdQYFGKkwfFFDkddodzk06I9+fAqhwz54b+RIAsIKc5D+yekSJPiGFiSLKxJAOMIiX1Ys8zK5+v18dIFl2I01oIBMas6M02ZzF1moiSmetXYFnGsROsLNoR54+lIEEJCw6KhMnicBXSDB3OwPG70heQ6c/7R5y8IKcdCOw4ZIYrcF6PG0yWVY8yyfDpEvZnwp6WnfUAK4ur3DkTCCxSsMivG8AyLlnXNg9Pk18k9cv7TjL1c2vv2WoRL+c44EgWLTKJF7IBTLvZvl4UO41HhP35H0HHKyGodcK3xVaL6xynIhGKFZvStwyYrmW7qyBx+unv/LZKeGyml9CXRcdGkK86VA3HARUjA4cNcX7Rsur+C9jYveyWSGy41tacbh+xm6oWsXqOU0tBpWfgoKKq18+arGuefSIIf+rb9QfeBznqDqoWZCPHaYiS0cJsHKNxAS7A2SXr+sY7wr8rKV/cYYzjAGGElWbDmRy0/4F0bQQJzhm+WkRKbnOcZnCUoi36nByWter2EoF9lnWIZNHOcVoLTzJsqZk5aLJAuvxEcJ+tOkgWiNMGhJGpBmbhILfMtvUNPwF3LqqM75tg5YlmnbCMHDbEleITThZs/6WiQySVNUHZOLCCnQKFV6Q4sPIwq/iFObPFFCcLllMOONkDy85ZTvKyYDmoVzm14xfluJK8LFgO6lUynX7O5ix9DvOyYDnskYyx4RfjrMNd/vjKrRTnBtpHowWLhotwLEEoi3BBS4pzU4k2UWZdfwHOK88elAXoUVIcvldJZowsM+elM8D3KCnObe5IdkIu4+fl2AjhMMZz2vkjGVVoxs/HsQS9qR5FuJdIHckSRUv4eTiWvV2fqFrwHOFIliiShZaBY93fT/U6VSKOqImn8yzSs5ScM2dnd3m26tSKONfjQhmO0eAIdBZn0cUewbf/maoWPEfSxJOnmxaDPhtn1vbXoKhHIUONIk6dtLekKdeyIRWdmDNr8RB8yUBVJ8zKguPcCEsPK2Qy4rKacLbDFDiLNrfQ6fh8SsgpbBFx5E08mQDHMqvZBEqqHp5X5uCO7CP20lv3KCsLjpOhiQdDGOawyO1cXXE4VtfdG3vEO6+kdfdBWXxhZcFxZE08fyMQiyeZ08/vA0H/rjetE9wSy4LjtJ91uyXvK3e2t31vfv0UEmTBc8663UrjAMbrDweHIfbqJ35Ncu9XRp+Ls7O943v78eA3/v4I+FMp4VxlcnJQMMARgQHt31USTvUVio4dZ+dsb+2AYJQhCSMci3/Jb5BwOprrvlMpafqEzHgf5XsjCQauryhN5asq6lvk96IdN6vLSk7ilGwpHaQHc0LTZElZbXNb1vvV1oYKVT5NS8/0EghYUlRh2fXGzpz3tM01ZaVAqhF5hCRw5IrqWl3Lee97O5uqVIWxuCTzESoeKSmrudV+wXvjlvpymHkUIhmj6XxV5Y3W/+7+ub0JZD5MR+jD0qu1zZe7x759o/IP1U3tuYb9B9Eohegx+UHyAAAAAElFTkSuQmCC",f={percentage:0},g=this;a.background("#000"),d=new Joy.Text({x:g.width/2,y:g.height/2,text:"0%",align:"center",font:"30pt Courier New, monospace",color:"#fff",alpha:0,baseline:Joy.Text.BASELINE.MIDDLE}).bind(Joy.Events.UPDATE,function(){var c=this;f.percentage!==a.loader.percentage&&(b&&b.stop(),f.percentage=a.loader.percentage,b=Joy.Tween({percentage:parseInt(c.text,10)},1e3).easing(Joy.TweenManager.Easing.Quadratic.Out).to({percentage:a.loader.percentage}).onUpdate(function(){c.text=parseInt(this.percentage,10)+"%"}).start())}),c=new Joy.Sprite(e).bind("load",function(){this.alpha=0,this.position.x=g.width/2,this.position.y=g.height/2,this.pivot.x+=this.width/2,this.pivot.y+=this.height/2,Joy.Tween(this.position).to({x:this.position.x-50}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(this,1e3).to({alpha:1}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(d,1e3).to({alpha:1}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(d.position,3e3).to({x:d.position.x+50}).easing(Joy.TweenManager.Easing.Quadratic.Out).start()}),a.addChild(c),a.addChild(d)}}(Joy),function(a){var b=a.Triggerable.extend({init:function(b){b||(b={}),this.id=b.id||Joy.generateUniqueId(),this.position=b.position||new a.Vector2d(b.x||0,b.y||0),Object.defineProperty(this,"collidePosition",{get:function(){var b=null!==this._parent?this._parent.collidePosition:new a.Vector2d;return b.sum(this.position).subtract(this.pivot)},configurable:!0}),this.pivot=b.pivot||new a.Vector2d(b.pivotX||0,b.pivotY||0),this.skew=b.skew||new a.Vector2d(b.skewX||0,b.skewY||0),this.scale=b.scale||new a.Vector2d(b.scaleX||1,b.scaleY||1),this.alpha="undefined"==typeof b.alpha?1:b.alpha,this.rotation=b.rotation||0,this.smooth="undefined"==typeof b.smooth?!0:b.smooth,this.destroyed=!1,this._width=b.width||0,this._height=b.height||0,Object.defineProperty(this,"collider",{get:function(){return this._collider},set:function(a){this._collider=a,this._collider.target=this},configurable:!0}),this._collider=b.collider||this,this.index=null,this.ctx=b.ctx||null,this._shadow=null,this._parent=null,this._visible="undefined"==typeof b.visible?!0:b.visible,this._matrix=a.Matrix2D.identity.clone(),this._collisionTargets=[],this._collisionActive={},this._hasContextOperations=!1,this._contextOperations={},Object.defineProperty(this,"parent",{get:function(){return this._parent},configurable:!0}),Object.defineProperty(this,"scene",{get:function(){for(var b=this._parent;!(b instanceof a.Scene)&&null!==b;)b=b&&b.parent||null;return b},configurable:!0}),Object.defineProperty(this,"visible",{get:function(){return this._visible&&this.alpha>0&&0!==this.scale.y&&0!==this.scale.y},set:function(a){this._visible=a},configurable:!0}),Object.defineProperty(this,"matrix",{get:function(){return this._matrix},configurable:!0}),Object.defineProperty(this,"width",{get:function(){return this._width*Math.abs(this.scale.x)},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return this._height*Math.abs(this.scale.y)},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.position.x+this.width},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.position.y+this.height},configurable:!0}),this.flipX=b.flipX||!1,this.flipY=b.flipY||!1,this._super(b),this.collider&&this.bind(a.Events.UPDATE,this.checkCollisions)},setContext:function(a){this.ctx=a},destroy:function(){return this.destroyed=!0,this},setScale:function(a,b){this.scale.x=a,this.scale.y=b},allowCollisionFrom:function(b){b instanceof a.DisplayObject&&(b=[b]);for(var c=0,d=b.length;d>c;++c)this._collisionTargets.push(b[c]);return this},translate:function(a,b){return this._hasContextOperations=!0,this._contextOperations.translate=[a,b],this},rotate:function(a){this.rotation=a},transform:function(a,b,c,d,e,f){return this._contextOperations.transform=[a,b,c,d,e,f],this},composite:function(a){return this.compositeOperation=a,this},fillStyle:function(a){return this._hasContextOperations=!0,this._contextOperations.fillStyle=a.toString(),this},fillRect:function(a,b,c,d){return this._hasContextOperations=!0,this._contextOperations.fillRect=[a,b,c,d],this},shadow:function(a){return this._shadow=a?{color:a.color||"#000",offsetX:a.offsetX||0,offsetY:a.offsetY||0,blur:a.blur||1}:null,this},updateContext:function(){var b={};b[!1]=-1,b[!0]=1;var c=this._matrix.identity().appendTransform(this.position.x+this.width*(this.flipX+0),this.position.y+this.height*(this.flipY+0),this.scale.x*b[!this.flipX],this.scale.y*b[!this.flipY],this.rotation,this.skew.x,this.skew.y,this.pivot.x,this.pivot.y);this.ctx.transform(c.m11,c.m12,c.m21,c.m22,c.dx,c.dy),this.ctx.globalAlpha*=this.alpha,this.compositeOperation&&(this.ctx.globalCompositeOperation=this.compositeOperation),this.ctx[a.Support.imageSmoothingEnabled]=this.smooth,this._shadow&&(this.ctx.shadowColor=this._shadow.color,this.ctx.shadowOffsetX=this._shadow.offsetX,this.ctx.shadowOffsetY=this._shadow.offsetY,this.ctx.shadowBlur=this._shadow.blur)},collide:function(a){return!(this.collidePosition.x>=a.collidePosition.x+a.width||a.collidePosition.x>=this.collidePosition.x+this.width||this.collidePosition.y>=a.collidePosition.y+a.height||a.collidePosition.y>=this.collidePosition.y+this.height)},checkCollisions:function(){var b,c=this._collisionTargets.length;if(0!==c){void 0!==this.collider.updateColliderPosition&&this.collider.updateColliderPosition(this.position),a.debug&&this.collider.renderStroke(this.ctx);for(var d=0;c>d;++d)b=this._collisionTargets[d].collider,b.collide(this.collider)?(this._collisionActive[b.id]||(this.trigger(a.Events.COLLISION_ENTER,[this._collisionTargets[d]]),this._collisionActive[b.id]=!0),this.trigger(a.Events.COLLISION,[this._collisionTargets[d]])):this._collisionActive[b.id]&&(delete this._collisionActive[b.id],this.trigger(a.Events.COLLISION_EXIT,[this._collisionTargets[d]]))}},willCollideAt:function(b){var c=new a.RectCollider(this.collider.position.clone().sum(b),1,1),d=this._collisionTargets.length;if(0!==d){c.updateColliderPosition(this.position);for(var e=0;d>e;++e)if(this._collisionTargets[e].collider.collide(c))return this._collisionTargets[e];return null}},render:function(){if(this.destroyed&&this.parent)return this.parent.removeChild(this),void 0;if(this._hasContextOperations)for(var a in this._contextOperations)this._contextOperations[a]instanceof Array?this.ctx[a].apply(this.ctx,this._contextOperations[a]):this.ctx[a]=this._contextOperations[a]},renderStroke:function(a){a.strokeStyle="red",a.strokeRect(this.collidePosition.x,this.collidePosition.y,this.width,this.height)},getMatrix:function(){return this._matrix.clone()},getBounds:function(){return new a.Rect(this.position.x,this.position.y,this.width,this.height)}});a.DisplayObject=b}(Joy),function(a){var b=a.DisplayObject.extend({init:function(a){if(a||(a={}),this.children=[],Object.defineProperty(this,"numChildren",{get:function(){return this.children.length},configurable:!0}),Object.defineProperty(this,"width",{get:function(){for(var a=0,b=0,c=this.children.length;c>b;++b)this.children[b].width>a&&(a=this.children[b].width);return a},configurable:!0}),Object.defineProperty(this,"height",{get:function(){for(var a=0,b=0,c=this.children.length;c>b;++b)this.children[b].height>a&&(a=this.children[b].height);return a},configurable:!0}),this._super(a),a.children)for(var b=0,c=a.children.length;c>b;++b)this.addChild(a.children[b])},setContext:function(a){this.ctx=a;for(var b=0,c=this.children.length;c>b;++b)this.children[b].setContext(a)},render:function(){this.visible&&(this.ctx.save(),this.updateContext(),this._super(),this.renderChildren(),this.ctx.restore())},renderChildren:function(){for(var b=0,c=this.children.length;c>b;++b)this.children[b].visible&&(this.ctx.save(),this.children[b].updateContext(),this.children[b].render(),this.children[b].trigger("update"),this.ctx.restore(),a.debug&&this.children[b].collider.renderStroke(this.ctx))},broadcast:function(a,b){this.trigger(a,b);for(var c=0,d=this.children.length;d>c;++c)this.children[c].trigger(a,b)},swapChildren:function(a,b){if(a.parent!==b.parent)throw new Error("DisplayObject must be at same level to swap.");var c=a.index;return this.children[c]=b,this.children[b.index]=a,a.index=b.index,b.index=c,this},addChild:function(b){return b.setContext(this.ctx),b.index=this.children.push(b)-1,b._parent=this,b.scene&&b.broadcast(a.Events.ADDED,[this]),this},getChildById:function(a){for(var b=0,c=this.children.length;c>b;++b)if(this.children[b].id==a)return this.children[b]},getChildAt:function(a){return this.children[a]},removeChild:function(a){var b=this.children.indexOf(a);return-1!==b&&this.removeChildAt(b),this},removeChildAt:function(b){var c=this.children.splice(b,1)[0];return c.trigger(a.Events.REMOVED,[this]),this}});a.DisplayObjectContainer=b}(Joy),function(a){a.Object.extend({init:function(){}})}(Joy),function(a){var b=a.DisplayObjectContainer.extend({init:function(b){this._super(b),this.viewport=b.viewport||null,this.distance=b.distance||1,this.velocity=b.velocity||1,this.bind(a.Events.ADDED,this._setup)},_setup:function(b){if(!(b instanceof a.Scene))throw new Error("'Parallax' instance must be added into a 'Scene'.");this.viewport=b.viewport;var c=this;this.viewport.bind("setup",function(){var a,b,d,e;for(a=0,b=c.numChildren;b>a;++a)if(c.getChildAt(a).position){for(d=c.getChildAt(a);d.numChildren>0;)d.removeChildAt(0);for(var f=0,g=Math.ceil(d.width/this.width)-1;g>f;++f)e=d.clone(),e.children=[],e.position.x=d.width,d.addChild(e)}}),this.viewport.bind("translate",function(){for(var a=c.distance,b=0,d=c.numChildren;d>b;++b)a*=c.velocity*(b+1),c.getChildAt(b).position&&(c.getChildAt(b).position.x+=this.translation.x*a/this.width,c.getChildAt(b).position.y+=this.translation.y*a/(this.height/2))})}});a.Parallax=b}(Joy),function(a){var b=a.DisplayObject.extend({init:function(b){this._super(b),this.emit="undefined"==typeof b.emit?!0:b.emit,this.sources="undefined"!=typeof b.source?[b.source]:b.sources,this.emission="undefined"!=typeof b.emission?new a.Range(b.emission):new a.Range(1,5),this.ease=b.ease||a.TweenManager.Easing.Linear,this.start=b.start||{},this.end=b.end||{},this.particleLifetime="undefined"!=typeof b.particleLifetime?new a.Range(b.particleLifetime):new a.Range(1,2),Object.defineProperty(this,"lifetime",{get:function(){return this._lifetime},set:function(b){this._lifetime=("undefined"!=typeof b?new a.Range(b):new a.Range(-1)).random()},configurable:!0}),this.lifetime=b.lifetime||1/0,this._ttl=1/0,this.bind(a.Events.ADDED,function(){for(var b=0,c=this.sources.length;c>b;b++)this.sources[b].trigger(a.Events.ADDED)}),this.bind(a.Events.SCENE_ACTIVE,this._activate)},_activate:function(){this._ttl=Date.now()+1e3*this.lifetime},_emit:function(b){for(var c,d=0;b>d;d+=1)c=this.sources[a.Range.randomInt(0,this.sources.length-1)].clone(),c.behave("Particle",{emitter:this,ease:this.ease,start:this.start,end:this.end,ttl:this.particleLifetime.random()}),this.parent.addChild(c);return this},render:function(){this._super(),!this.emit||Date.now()>this._ttl||this._emit(1)}});a.ParticleEmitter=b}(Joy),function(a){var b=a.DisplayObjectContainer.extend({init:function(b){b||(b={}),"undefined"==typeof b.visible&&(b.visible=!1),this._super(b),this.loader="undefined"==typeof b.loader?new a.Loader:b.loader,this.paused=!1,this.shaders=[],this.viewport=b.viewport||new a.Viewport({scene:this})},background:function(b){return this.fillStyle(b.toString()),this.fillRect(0,0,this.width||a.currentEngine.width,this.height||a.currentEngine.height),this},pause:function(b){return b=b||{},b.blur&&(this.render(),a.Shader.process(this.ctx,a.Shader.blur,b.blur)),this.paused=!0,this.trigger("pause"),this},updateContext:function(){this._super(),this.viewport.follow&&this.viewport.updateContext()},render:function(){if(!this.paused&&(this.updateContext(),this._super(),this.viewport.render(),this.shaders.length>0))for(var b=0,c=this.shaders.length;c>b;++b)a.Shader.process(this.ctx,this.shaders[b][0],this.shaders[b][1])},broadcast:function(a,b){this.viewport.broadcast(a,b),this._super(a,b)},fadeOut:function(b,c){var d=this,e=new a.Rect({width:this.viewport.width,height:this.viewport.height,color:c,alpha:0});d.trigger("fadeOutStart"),this.viewport.addHud(e);var f=setInterval(function(){e.alpha+=1e3/b/60*a.deltaTime,e.alpha>=1&&(clearInterval(f),d.viewport.hud.removeChild(e),d.trigger("fadeOutComplete"))},1);return this},fadeIn:function(b,c){var d=this,e=new a.Rect({width:this.viewport.width,height:this.viewport.height,color:c,alpha:1});d.trigger("fadeInStart"),this.viewport.addHud(e);var f=setInterval(function(){e.alpha-=1e3/b/60*a.deltaTime,e.alpha<=0&&(clearInterval(f),d.viewport.hud.removeChild(e),d.trigger("fadeInComplete"))},1e3/60);return this},addShader:function(a,b){return this.shaders.push([a,b]),this}});a.Scene=b}(Joy),function(a){var b=a.DisplayObjectContainer.extend({init:function(b){"string"==typeof b&&(b={src:b}),this.image=b.image||new Image,b.width=this.image.width||b.width,b.height=this.image.height||b.height,this._super(b),this.bind(a.Events.ADDED,function(){b.src&&this.load(b.src)
})},load:function(a){var b=this;this.scene&&this.scene.loader&&!this.scene.loader.completed&&this.scene.loader.add(this.image),this.image.addEventListener("load",function(){b.onLoad(),b.trigger("load")}),this.image.src=a},onLoad:function(){this._width||(this._width=this.image.width),this._height||(this._height=this.image.height)},render:function(){this.visible&&(this.ctx.drawImage(this.image,0,0,this._width,this._height),this.renderChildren())},clone:function(){var b=new a.Sprite(this);return this.position=this.position.clone(),this.scale=this.scale.clone(),this.pivot=this.pivot.clone(),this.skew=this.skew.clone(),b}});a.Sprite=b}(Joy),function(a){var b=function(a){this.parent=a.parent,this.name=a.name,this.framesPerSecond=a.framesPerSecond,this.frames=a.frames,this.firstFrame=this.frames[0],this.lastFrame=lastFrame=this.frames[1]||this.frames[0],this.currentFrame=0};b.prototype.start=function(){this.currentFrame=this.firstFrame;var a=this;this._interval=setInterval(function(){a.update()},1e3/this.framesPerSecond)},b.prototype.stop=function(){return this._interval&&clearInterval(this._interval),this},b.prototype.update=function(){this.currentFrame==this.lastFrame?(this.currentFrame=this.firstFrame,this.parent.trigger("animationStart")):(this.currentFrame=this.currentFrame+1,this.currentFrame==this.lastFrame&&this.parent.trigger("animationEnd"))},a.SpriteAnimation=b}(Joy),function(a){var b=a.Sprite.extend({init:function(a){if(this._super(a),this.animations={length:0},this._frequencyInterval=null,this.frames=1,this.framesPerSecond=a.framesPerSecond||a.fps||24,a.animations)for(var b in a.animations)this.addAnimation(b,a.animations[b]);this.currentAnimationName="all",Object.defineProperty(this,"fps",{get:function(){return this.framesPerSecond},configurable:!0}),Object.defineProperty(this,"currentAnimation",{get:function(){return this.animations[this.currentAnimationName]},configurable:!0})},addAnimation:function(b,c){return this.animations[b]=new a.SpriteAnimation({parent:this,name:b,frames:c instanceof Array?c:c.frames,framesPerSecond:c.framesPerSecond||this.framesPerSecond}),this.animations.length=(this.animations.length||0)+1,this},onLoad:function(){this._super();var a=1;this._width<this.image.width&&(a=this._columns=Math.ceil(this.image.width/this._width)),this._height<this.image.height&&(a*=this._rows=Math.ceil(this.image.height/this._height)),this.addAnimation("all",[0,a-1]),(0===this.animations.length||null===this.currentAnimation)&&this.play("all")},play:function(a){if(this.currentAnimationName!=a){if(this.currentAnimation&&this.currentAnimation.stop(),this.currentAnimationName=a,!this.animations[a])throw new Error("Animation '"+a+"' not found on '"+this.id+"'");this.animations[a].start()}return this},stop:function(){this.currentAnimation.stop()},render:function(){this.visible&&this.ctx.drawImage(this.image,this._width*(this.currentAnimation.currentFrame%this._columns),this._height*(this.currentAnimation.currentFrame/this._columns>>0),this._width,this._height,0,0,this._width,this._height)}});a.SpriteSheet=b}(Joy),function(a){var b={TOP:"top",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"},c="Normal 12px Verdana",d="#000000",e="left",f=b.TOP,g=a.DisplayObject.extend({init:function(a){"undefined"==typeof a&&(a={}),this._super(a),this.text=a.text||"",this.font=a.font||c,this.align=a.align||e,this.baseline=a.baseline||f,this._color=a.color||d,Object.defineProperty(this,"color",{get:function(){return this._color},set:function(a){this._color=a.toString()},configurable:!0}),a.stroke?this.useStroke():this.useFill()},useStroke:function(){this.stroke=!0,this.fillMethod="strokeText",this.styleMethod="strokeStyle"},useFill:function(){this.stroke=!1,this.fillMethod="fillText",this.styleMethod="fillStyle"},updateContext:function(){this._super(),this.ctx.font=this.font,this.ctx.textAlign=this.align,this.ctx.textBaseline=this.baseline,this.ctx[this.styleMethod]=this.color,this.ctx[this.fillMethod](this.text,0,0)},getMeasure:function(){return this.ctx.measureText(this.text)}});g.BASELINE=b,a.Text=g}(Joy),function(a){var b=a.DisplayObjectContainer.extend({init:function(b){if(!(b.tileset instanceof a.Tileset))throw new Error("'tileset' must be given on Tilemap constructor, as Sprite instance.");this._super(b),this.tileset=b.tileset,this.lines=b.lines||1,this.columns=b.columns||1,Object.defineProperty(this,"data",{get:function(){return this._data},set:function(b){this._data=b,(this.collider==this||this.collider instanceof a.TilemapCollider)&&(this.collider=new a.TilemapCollider(this))},configurable:!0}),this.data=b.data,Object.defineProperty(this,"height",{get:function(){return this.lines*this.tileset.tileHeight},configurable:!0}),Object.defineProperty(this,"width",{get:function(){return this.columns*this.tileset.tileWidth},configurable:!0}),this.bind(a.Events.ADDED,function(){this.tileset.trigger(a.Events.ADDED)})},renderChildren:function(){for(var a=0,b=this.data.length;b>a;++a)0!==this.data[a]&&this.ctx.drawImage(this.tileset.image,this.tileset.tileWidth*((this.data[a]-1)%this.tileset.columns),this.tileset.tileHeight*((this.data[a]-1)/this.tileset.columns>>0),this.tileset.tileWidth,this.tileset.tileHeight,this.tileset.tileWidth*(a%this.columns),this.tileset.tileHeight*(a/this.columns>>0),this.tileset.tileWidth,this.tileset.tileHeight)}});a.Tilemap=b}(Joy),function(a){var b=a.Sprite.extend({init:function(a){this.tileWidth=a.width,this.tileHeight=a.height,delete a.width,delete a.height,this._super(a)},onLoad:function(){this._super(),this.columns=this._width/this.tileWidth>>0,this.lines=this._height/this.tileHeight>>0}});a.Tileset=b}(Joy),function(a){var b=a.Triggerable.extend({init:function(b){this._super(b),this.id=b.id||Joy.generateUniqueId(),this.position=new a.Vector2d,this._lastPosition=new a.Vector2d,this.translation=new a.Vector2d,b.scene&&(this.scene=b.scene,this.ctx=this.scene.ctx),this.hud=new a.DisplayObjectContainer({id:this.id+"_HUD",ctx:this.ctx}),this.hud.position=this.position,this.active=!0,this._translationTotal=new a.Vector2d,this.setup(b)},addHud:function(a){return this.hud.addChild(a)},setup:function(b){this.width=b.width||this.scene.ctx.canvas.width,this.height=b.height||this.scene.ctx.canvas.height,b.follow&&(this.follow=b.follow),this.scale=new a.Vector2d(1,1),this.bind(a.Events.SCENE_ACTIVE,function(){this.width&&this.height&&this.setSize(this.width,this.height),this.trigger("setup")})},setSize:function(a,b){return this.reset(),this.width=a,this.height=b,this.ctx.scale(this.ctx.canvas.width/this.width*this.scale.x,this.ctx.canvas.height/this.height*this.scale.y),this.scale.x=this.width/this.ctx.canvas.width,this.scale.y=this.height/this.ctx.canvas.height,this},setDeadzone:function(b,c){return this.deadzone=new a.Vector2d(b,c),this},updateContext:function(){this.width/2,this.height/2,this.position.x=~~(this.follow.position.x+this.follow.width/2-this.width/2),this.position.y=~~(this.follow.position.y+this.follow.height/2-this.height/2),this.translation.x=-this.position.x+this._lastPosition.x,this.translation.y=-this.position.y+this._lastPosition.y,this._translationTotal.sum(this.translation),this.active&&(this.trigger("translate"),this.ctx.translate(this.translation.x,this.translation.y)),this._lastPosition.x=this.position.x,this._lastPosition.y=this.position.y},render:function(){this.hud.render()},reset:function(){return this.translation.x=-this._translationTotal.x,this.translation.y=-this._translationTotal.y,this.ctx.translate(this.translation.x,this.translation.y),this.trigger("translate"),this._translationTotal.set(0,0),this._lastPosition.set(0,0),this}});a.Viewport=b}(Joy),function(a){var b=a.DisplayObject.extend({init:function(a){this._super(a),this.radius=a.radius||1,this.color=a.color||"#000",Object.defineProperty(this,"width",{get:function(){return 2*this.radius*this.scale.x},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return 2*this.radius*this.scale.y},configurable:!0})},render:function(){this.ctx.beginPath(),this.ctx.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.ctx.fillStyle=this.color,this.ctx.fill()}});a.Circle=b}(Joy),function(a){var b=a.DisplayObject.extend({init:function(a){this._super(a),a.color&&this.colorize(a.color)},colorize:function(a){return this.color=a.toString(),this},render:function(){this.color&&(this.ctx.fillStyle=this.color),this.ctx.fillRect(0,0,this._width,this._height)}});a.Rect=b}(Joy),function(a){a.Sound=Howl}(Joy),function(a){a.TweenManager=TWEEN,a.Tween=function(a,b){return new TWEEN.Tween(a,b)}}(Joy),function(a){var b=a.Object.extend({});b.behaviours={},b.define=function(a,c){return this.behaviours[a]=b.extend(c),this.behaviours[a].id=a,this.behaviours[name]},b.get=function(a){return this.behaviours[a]},Joy.Behaviour=b}(Joy),function(a){a.Behaviour.define("Button",{INIT:function(){this.isOver=!1},UPDATE:function(){var b=a.Mouse.isOver(this);b&&!this.isOver?this.trigger(a.Events.MOUSE_OVER):!b&&this.isOver&&this.trigger(a.Events.MOUSE_OUT),this.isOver=b}})}(Joy),function(a){a.Behaviour.Movimentation=a.Behaviour.define("Movimentation",{INIT:function(){this.velocity=new a.Vector2d,this.maxVelocity=new a.Vector2d(500,500),Object.defineProperty(this,"direction",{get:function(){return this.velocity.normalized},configurable:!0}),this.acceleration=new a.Vector2d,this.friction=new a.Vector2d},UPDATE:function(){this.friction.x&&(this.velocity.x=a.Utils.applyFriction(this.velocity.x,this.friction.x)),this.friction.y&&(this.velocity.y=a.Utils.applyFriction(this.velocity.y,this.friction.y)),this.velocity.x+=this.acceleration.x*a.deltaTime,this.velocity.y+=this.acceleration.y*a.deltaTime,0!==this.velocity.x&&(this.velocity.x=Math.clamp(this.velocity.x,-this.maxVelocity.x,this.maxVelocity.x)),0!==this.velocity.y&&(this.velocity.y=Math.clamp(this.velocity.y,-this.maxVelocity.y,this.maxVelocity.y)),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}})}(Joy),function(a){function b(b,c){var d={};return d.position=new a.Vector2d,d.position.x=b.position.x+a.Range.parse(c.position&&c.position.x||{}).randomInt(),d.position.y=b.position.y+a.Range.parse(c.position&&c.position.y||{}).randomInt(),d.scale=new a.Vector2d,d.scale.x=a.Range.parse(c.scale&&c.scale.x||b.scale.x).randomInt(),d.scale.y=a.Range.parse(c.scale&&c.scale.y||b.scale.y).randomInt(),d.alpha=a.Range.parse("undefined"==typeof c.alpha?b.alpha:c.alpha).randomInt(),d.rotation=a.Range.parse("undefined"==typeof c.rotation?b.rotation:c.rotation).randomInt(),d}a.Behaviour.define("Particle",{init:function(a){this.particleOptions=a},ADDED:function(){var c=b(this.particleOptions.emitter,this.particleOptions.start||{}),d=b(this.particleOptions.emitter,this.particleOptions.end||{});for(var e in c)this[e]=c[e],"object"==typeof d[e]&&(a.Tween(c[e],1e3*this.particleOptions.ttl).to(d[e]).start(),delete d[e]);a.Tween(this,1e3*this.particleOptions.ttl).to(d).onComplete(this.destroy).start()}})}(Joy),function(a){a.Behaviour.define("Physics",{INIT:function(){},UPDATE:function(){}})}(Joy),function(a){var b=function(b,c,d){this.id=a.generateUniqueId(),this.position=b,this.collidePosition=this.position.clone(),this.width=c,this.height=d};b.prototype.updateColliderPosition=function(a){this.collidePosition.x=a.x+this.position.x,this.collidePosition.y=a.y+this.position.y},b.prototype.renderStroke=function(a){a.strokeStyle="red",a.strokeRect(this.collidePosition.x,this.collidePosition.y,this.width,this.height)},b.prototype.collide=function(a){return!(this.collidePosition.x>=a.collidePosition.x+a.width||a.collidePosition.x>=this.collidePosition.x+this.width||this.collidePosition.y>=a.collidePosition.y+a.height||a.collidePosition.y>=this.collidePosition.y+this.height)},b.prototype.clone=function(){return new b(this.position.clone(),this.width,this.height)},a.RectCollider=b}(Joy),function(a){var b=function(b){this.blocks=[];for(var c=0,d=b.data.length;d>c;++c)0!==b.data[c]&&this.blocks.push(new Joy.RectCollider(new a.Vector2d(b.tileset.tileWidth*(c%b.columns),b.tileset.tileHeight*(c/b.columns>>0)),b.tileset.tileWidth,b.tileset.tileHeight));this.length=this.blocks.length};b.prototype.collide=function(a){for(var b=0;b<this.length;++b)if(!(this.blocks[b].collidePosition.x>=a.collidePosition.x+a.width||a.collidePosition.x>=this.blocks[b].collidePosition.x+this.blocks[b].width||this.blocks[b].collidePosition.y>=a.collidePosition.y+a.height||a.collidePosition.y>=this.blocks[b].collidePosition.y+this.blocks[b].height))return!0;return!1},b.prototype.renderStroke=function(a){for(var b=0;b<this.length;++b)a.strokeRect(this.blocks[b].position.x,this.blocks[b].position.y,this.blocks[b].width,this.blocks[b].height)},a.TilemapCollider=b}(Joy),function(a){var b=function(a){this.setCanvas(a.canvas)};b.prototype.setCanvas=function(a){return this.canvas=a,this.ctx=a.getContext("2d"),this},b.prototype.clear=function(){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this},b.prototype.render=function(a){this.clear();for(var b=0,c=a.length;c>b;++b)a[b].visible&&a[b].render()},a.Context.Context2d=b}(Joy),function(J){var Markup=function(a){this.engine=a,this.canvas=a.context.canvas,this.parsers={IMG:function(a,b){return new J.Sprite(b)},LABEL:function(a,b){return b.text=a.innerHTML,new J.Text(b)},DIV:function(a,b){for(var c=new J.DisplayObjectContainer(b),d=a.querySelector("*"),e=0,f=d.length;f>e;e++)c.addChild(this.parsers[d[e].tagName].apply(this,[d[e],Markup.evaluateDataset(d[e])]));return c},AUDIO:function(){new J.Sound({})}}};Markup.prototype.parse=function(){var a=this.canvas.querySelectorAll("section");0===a.length&&(a=[this.canvas]);for(var b=0;b<a.length;b++)this.createScene(a[b])},Markup.prototype.createScene=function(a){var b,c,d=[],e=a.querySelectorAll("*");for(b=0,c=e.length;c>b;++b)if(this.parsers[e[b].tagName]){var f=this.parsers[e[b].tagName].apply(this,[e[b],Markup.evaluateDataset(e[b])]);d.push(f)}var g=Markup.evaluateDataset(a);this.engine.createScene(function(a){for(var e in g)console.log(e,g[e]),"function"==typeof a[e]?a[e](g[e]):a[e]=g[e];for(b=0,c=d.length;c>b;++b)a.addChild(d[b])})},Markup.evaluateDataset=function(el){var value,matches,attr,attributeName,attributes=el.attributes,obj={};for(var key in attributes)attr=attributes[key],"object"==typeof attr&&(value=""===attr.value?!0:attr.value,attributeName=attr.name,0===attributeName.indexOf("data-")&&(attributeName=attributeName.substr(5,attributeName.length)),matches=attr.value.match(/\{\{([^\}]*)\}\}/),matches&&(value=value.replace(value,eval(matches[1]))),obj[attributeName]=value);return obj},J.Markup=Markup}(Joy),function(a){var b=function(){};a.Package=b}(Joy),function(a){function b(a,b){var d,e,f=c.handlers[a];for(d=0,e=f.length;e>d;++d)f[d].handler.apply(f[d].target,[b])}var c={ENTER:13,SPACE:32,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};a.Events.KEY_DOWN="onkeydown",a.Events.KEY_UP="onkeyup",a.Events.KEY_PRESS="key",c.repeatRate=1,c.handlers={},c.timers={},[a.Events.KEY_DOWN,a.Events.KEY_UP,a.Events.KEY_PRESS].forEach(function(b){c.handlers[b]=[],a.Triggerable.register(b,function(a){-1===c.handlers[b].indexOf(a)&&c.handlers[b].push(a)},function(a){var d=c.handlers[b].indexOf(a);-1!==d&&c.handlers[b].splice(d,1)})}),document.onkeydown=function(d){var e=(d||window.event).keyCode;return c.timers[e]||(b(a.Events.KEY_DOWN,d),b(a.Events.KEY_PRESS,d),0!==c.repeatRate&&(c.timers[e]=setInterval(function(){b(a.Events.KEY_PRESS,d)},c.repeatRate))),!1},document.onkeyup=function(d){var e=(d||window.event).keyCode;e in c.timers&&(b(a.Events.KEY_UP,d),c.timers[e]&&clearInterval(c.timers[e]),delete c.timers[e])},Joy.Keyboard=c}(Joy),function(a){var b={collider:new a.RectCollider(new a.Vector2d,1,1),lastEvent:null,updateColliderPosition:function(c){b.collider.position.x=c.offsetX*a.currentEngine.currentScene.viewport.scale.x,b.collider.position.y=c.offsetY*a.currentEngine.currentScene.viewport.scale.y,b.collider.updateColliderPosition(a.currentEngine.currentScene.viewport.position)},isOver:function(a){return a.collider.collide(b.collider)},enable:function(c){var d=function(a){var c=b.handlers[a.type];this.lastEvent=a,b.updateColliderPosition(a);for(var d=0,e=c.length;e>d;++d)c[d].target.visible&&b.isOver(c[d].target)&&c[d].handler.apply(c[d].target,[a])};c.context.canvas["on"+a.Events.CLICK]=d,c.context.canvas["on"+a.Events.DOUBLE_CLICK]=d,c.context.canvas["on"+a.Events.MOUSE_MOVE]=d,c.context.canvas["on"+a.Events.MOUSE_DOWN]=d,c.context.canvas["on"+a.Events.MOUSE_UP]=d},handlers:{},timers:{}};a.Events.MOUSE_DOWN="mousedown",a.Events.MOUSE_UP="mouseup",a.Events.MOUSE_MOVE="mousemove",a.Events.CLICK="click",a.Events.DOUBLE_CLICK="dblclick",a.Events.MOUSE_OVER="mouseover",a.Events.MOUSE_OUT="mouseout",[a.Events.CLICK,a.Events.DOUBLE_CLICK,a.Events.DOUBLE_CLICK,a.Events.MOUSE_MOVE,a.Events.MOUSE_DOWN,a.Events.MOUSE_UP].forEach(function(c){b.handlers[c]=[],a.Triggerable.register(c,function(a){-1===b.handlers[c].indexOf(a)&&b.handlers[c].push(a)},function(a){var d=b.handlers[c].indexOf(a);-1!==d&&b.handlers[c].splice(d,1)})}),a.Mouse=b}(Joy),function(a){if(a.Support.touch){var b={};a.Events.TOUCH_START="touchstart",a.Events.TOUCH_MOVE="touchmove",a.Events.TOUCH_END="touchend",a.Touch=b}}(Joy);